{"version":3,"sources":["components/Recaptcha/style.ts","components/Recaptcha/Recaptcha.tsx","hooks/useAxios.ts","helper/submitHelper.ts","helper/validationHelper.ts","containers/SubmitSteps/Questionary/Step3/Step3.tsx"],"names":["RecaptchaContainer","styled","div","Recaptcha","onChange","setRecaptchaAvailable","onReady","i18n","useTranslation","useEffect","onPageLoad","document","readyState","window","addEventListener","removeEventListener","sitekey","process","onErrored","Sentry","hl","language","size","client","axios","create","baseURL","doSubmit","a","setSubmitError","state","captchaValue","action","nextStep","setActiveStep","history","welcome","patientId","agreedConsentTerms","agreedPolicyTerms","agreedCovidDetection","agreedCovidCollection","agreedTrainingArtificial","agreedBiometric","recordYourCough","currentSymptoms","symptomsStartedDate","body","FormData","append","sourceCampaign","coughFile","recordingFile","uploadedFile","name","selected","length","join","other","axiosClient","post","headers","response","data","submissionId","push","console","log","executeValidation","symptoms","covidSymptoms","output","index","includes","stepSchema","Yup","when","is","val","then","schema","required","otherwise","defined","React","memo","previousStep","storeKey","metadata","Portal","usePortal","bindTo","getElementById","useHeaderContext","setDoGoBack","setTitle","setType","useHistory","t","useStateMachine","updateAction","useState","activeStep","useForm","mode","defaultValues","resolver","yupResolver","control","handleSubmit","formState","watch","errors","isValid","watchSymptoms","submitError","setCaptchaValue","recaptchaAvailable","loadingRecaptcha","setLoadingRecaptcha","isSubmitting","onSubmit","values","s","TagManager","dataLayer","event","handleDoBack","useCallback","goBack","callAfterScriptLoads","scrollToTop","covidSymptom","useMemo","ProgressIndicator","currentStep","current","totalSteps","total","progressBar","extraSpace","first","defaultValue","render","value","OptionList","singleSelection","v","items","label","className","WizardButtons","invert","leftLabel","leftDisabled","leftHandler"],"mappings":"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","file":"static/js/45.312fed82.chunk.js","sourcesContent":["import styled from 'styled-components';\n\nexport const RecaptchaContainer = styled.div`\n  margin: 20px 0;\n  \n  div {\n    margin: auto;\n  }\n`;\n","import React, { useEffect } from 'react';\nimport ReCAPTCHA from 'react-google-recaptcha';\nimport { useTranslation } from 'react-i18next';\n\n// Sentry\nimport * as Sentry from '@sentry/react';\n\n// Style\nimport { RecaptchaContainer } from './style';\n\nconst recaptchaKey = process.env.REACT_APP_RECAPTCHA_KEY || '';\n\ninterface RecaptchaProps {\n  onChange(token: string | null): void;\n  setRecaptchaAvailable(state: boolean): void;\n  onReady: () => void;\n}\n\nconst Recaptcha = ({ onChange, setRecaptchaAvailable, onReady }: RecaptchaProps) => {\n  const { i18n } = useTranslation();\n\n  useEffect(() => {\n    // callback function to call when event triggers\n    const onPageLoad = () => onReady();\n\n    // Check if the page has already loaded\n    if (document.readyState === 'complete') {\n      return onPageLoad();\n    }\n    window.addEventListener('load', onPageLoad, false);\n    // Remove the event listener when component unmounts\n    return () => window.removeEventListener('load', onPageLoad);\n  }, [onReady]);\n\n  if (!recaptchaKey) return null;\n\n  return (\n    <RecaptchaContainer>\n      <ReCAPTCHA\n        sitekey={process.env.REACT_APP_RECAPTCHA_KEY || ''}\n        onChange={onChange}\n        onErrored={() => { setRecaptchaAvailable(false); Sentry.captureException('Error on ReCAPTCHA'); }}\n        hl={i18n.language}\n        size=\"compact\"\n      />\n    </RecaptchaContainer>\n  );\n};\n\nexport default Recaptcha;\n","import axios from 'axios';\n\nexport const client = axios.create({\n  baseURL: process.env.REACT_APP_API,\n});\n\nexport default function useAxios() {\n  return client;\n}\n","import * as H from 'history';\n\n// Hooks\nimport { client as axiosClient } from 'hooks/useAxios';\n\ninterface DoSubmitProps {\n  setSubmitError(err: string | null): void;\n  state: CommonJSON;\n  captchaValue: string | null;\n  action(payload: Object): void;\n  nextStep?: string;\n  setActiveStep(status: boolean): void;\n  history: H.History;\n}\n\nexport async function doSubmit({\n  setSubmitError,\n  state,\n  captchaValue,\n  action,\n  nextStep,\n  setActiveStep,\n  history,\n}: DoSubmitProps) {\n  try {\n    setSubmitError(null);\n    const {\n      patientId,\n      agreedConsentTerms,\n      agreedPolicyTerms,\n      agreedCovidDetection,\n      agreedCovidCollection,\n      agreedTrainingArtificial,\n      agreedBiometric,\n    } = state.welcome;\n\n    const {\n      recordYourCough,\n      currentSymptoms,\n      symptomsStartedDate,\n\n    } = state['submit-steps'];\n\n    const body = new FormData();\n\n    if (patientId) {\n      body.append('patientId', patientId);\n    }\n\n    if (window.sourceCampaign) {\n      body.append('source', window.sourceCampaign);\n    }\n\n    body.append('agreedConsentTerms', agreedConsentTerms);\n    body.append('agreedPolicyTerms', agreedPolicyTerms);\n    body.append('agreedCovidCollection', agreedCovidCollection);\n    body.append('agreedCovidDetection', agreedCovidDetection);\n    body.append('agreedTrainingArtificial', agreedTrainingArtificial);\n    body.append('agreedBiometric', agreedBiometric);\n\n    const coughFile = recordYourCough.recordingFile || recordYourCough.uploadedFile;\n    body.append('cough', coughFile, coughFile.name || 'filename.wav');\n\n    if (currentSymptoms?.selected?.length > 0) {\n      body.append('currentSymptoms', currentSymptoms.selected.join(','));\n    }\n\n    if (symptomsStartedDate) {\n      body.append('symptomsStartedDate', symptomsStartedDate);\n    }\n\n    if (currentSymptoms?.other) {\n      body.append('otherSymptoms', currentSymptoms?.other);\n    }\n\n    if (captchaValue) {\n      body.append('captchaValue', captchaValue);\n    }\n\n    const response = await axiosClient.post('saveCompensarInfo', body, {\n      headers: {\n        'Content-Type': 'multipart/form-data; boundary=saveCompensarInfo',\n      },\n    });\n\n    action({});\n\n    if (nextStep && response.data?.submissionId) {\n      setActiveStep(false);\n      history.push(nextStep, { submissionId: response.data?.submissionId });\n    }\n  } catch (error) {\n    console.log(error);\n    setSubmitError('beforeSubmit:submitError');\n  }\n}\n","interface SymptomsProps {\n  selected: string[];\n}\n\nexport function executeValidation(symptoms : SymptomsProps) {\n  if (!symptoms?.selected) return false;\n  const { selected } = symptoms;\n  const covidSymptoms = ['breathShortness', 'feverChillsSweating', 'dryCough', 'wetCough', 'newOrWorseCough'];\n\n  let output = false;\n  // eslint-disable-next-line no-plusplus\n  for (let index = 0; !output && index < selected?.length; index++) {\n    output = covidSymptoms.includes(selected[index]);\n  }\n\n  return output;\n}\n","import React, { useCallback, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport usePortal from 'react-useportal';\nimport { useTranslation } from 'react-i18next';\nimport TagManager from 'react-gtm-module';\n\n// Form\nimport { useForm, Controller } from 'react-hook-form';\nimport { useStateMachine } from 'little-state-machine';\nimport { yupResolver } from '@hookform/resolvers';\nimport { ErrorMessage } from '@hookform/error-message';\nimport * as Yup from 'yup';\n\n// Update Action\nimport { updateAction } from 'utils/wizard';\n\n// Components\nimport WizardButtons from 'components/WizardButtons';\nimport ProgressIndicator from 'components/ProgressIndicator';\nimport OptionList from 'components/OptionList';\nimport Recaptcha from 'components/Recaptcha';\n\n// Header Control\nimport useHeaderContext from 'hooks/useHeaderContext';\n\n// Utils\nimport { scrollToTop } from 'helper/scrollHelper';\nimport { doSubmit } from 'helper/submitHelper';\nimport { executeValidation } from 'helper/validationHelper';\n\n// Styles\nimport {\n  QuestionText, MainContainer, TempBeforeSubmitError,\n} from '../style';\n\nconst stepSchema = Yup.object({\n  symptomsStartedDate: Yup.string().when('currentSymptoms', {\n    is: val => executeValidation(val), // val should be { selected: ... },\n    then: (schema: any) => schema.required(), // o Yup.string().required(),\n    otherwise: (schema: any) => schema, // o Yup.string()\n  }),\n}).defined();\n\ntype Step3Type = Yup.InferType<typeof stepSchema>;\n\nconst Step3 = ({\n  previousStep,\n  nextStep,\n  storeKey,\n  metadata,\n}: Wizard.StepProps) => {\n  // Hooks\n  const { Portal } = usePortal({\n    bindTo: document && document.getElementById('wizard-buttons') as HTMLDivElement,\n  });\n  const { setDoGoBack, setTitle, setType } = useHeaderContext();\n  const history = useHistory();\n  const { t } = useTranslation();\n  const { state, action } = useStateMachine(updateAction(storeKey));\n\n  // States\n  const [activeStep, setActiveStep] = React.useState(true);\n\n  // Form\n  const {\n    control, handleSubmit, formState, watch,\n  } = useForm({\n    mode: 'onChange',\n    defaultValues: state?.[storeKey],\n    resolver: yupResolver(stepSchema),\n  });\n  const { errors, isValid } = formState;\n  const watchSymptoms = watch('currentSymptoms');\n\n  /* Delete after Contact info step is re-integrated */\n  const [submitError, setSubmitError] = React.useState<string | null>(null);\n  const [captchaValue, setCaptchaValue] = React.useState<string | null>(null);\n  const [recaptchaAvailable, setRecaptchaAvailable] = React.useState(true);\n  const [loadingRecaptcha, setLoadingRecaptcha] = React.useState(true);\n  const { isSubmitting } = formState;\n\n  useEffect(() => {\n    if (!captchaValue) {\n      setSubmitError(null);\n    }\n  }, [captchaValue]);\n\n  const onSubmit = async (values: Step3Type) => {\n    if (values) {\n      await doSubmit({\n        setSubmitError: s => setSubmitError(!s ? null : t(s)),\n        state: {\n          ...state,\n          'submit-steps': {\n            ...state['submit-steps'],\n            ...values,\n          },\n        },\n        captchaValue,\n        action,\n        nextStep,\n        setActiveStep,\n        history,\n      });\n\n      TagManager.dataLayer({\n        dataLayer: {\n          event: 'successful_session',\n        },\n      });\n    }\n  };\n\n  const handleDoBack = React.useCallback(() => {\n    setActiveStep(false);\n    if (previousStep) {\n      history.push(previousStep);\n    } else {\n      history.goBack();\n    }\n  }, [history, previousStep]);\n\n  const callAfterScriptLoads = useCallback(() => {\n    setLoadingRecaptcha(false);\n  }, []);\n\n  useEffect(() => {\n    scrollToTop();\n    setTitle(t('questionary:headerQuestions'));\n    setType('primary');\n    setDoGoBack(() => handleDoBack);\n  }, [handleDoBack, setDoGoBack, setTitle, setType, t]);\n\n  const covidSymptom = React.useMemo(() => executeValidation(watchSymptoms), [watchSymptoms]);\n\n  return (\n    <MainContainer>\n      <ProgressIndicator\n        currentStep={metadata?.current}\n        totalSteps={metadata?.total}\n        progressBar\n      />\n      {\n        covidSymptom && (\n          <>\n            <QuestionText extraSpace first>\n              {t('questionary:symptomsDate')}\n            </QuestionText>\n            <Controller\n              control={control}\n              name=\"symptomsStartedDate\"\n              defaultValue=\"\"\n              render={({ onChange, value }) => (\n                <OptionList\n                  singleSelection\n                  value={{ selected: value ? [value] : [] }}\n                  onChange={v => onChange(v.selected[0])}\n                  items={[\n                    {\n                      value: 'today',\n                      label: t('questionary:options.today'),\n                    },\n                    {\n                      value: 'days',\n                      label: t('questionary:options.days'),\n                    },\n                    {\n                      value: 'week',\n                      label: t('questionary:options.week'),\n                    },\n                    {\n                      value: 'overWeek',\n                      label: t('questionary:options.overWeek'),\n                    },\n                  ]}\n                />\n              )}\n            />\n          </>\n        )\n      }\n      {/* Bottom Buttons */}\n      <p><ErrorMessage errors={errors} name=\"name\" /></p>\n      {activeStep && (\n        <Portal>\n          { /* ReCaptcha  */}\n          {\n            loadingRecaptcha && (\n              <div className=\"text-center\">Cargando, por favor espere...</div>\n            )\n          }\n          <Recaptcha\n            onReady={callAfterScriptLoads}\n            onChange={setCaptchaValue}\n            setRecaptchaAvailable={setRecaptchaAvailable}\n          />\n          {submitError && (\n            <TempBeforeSubmitError>\n              {submitError}\n            </TempBeforeSubmitError>\n          )}\n          <WizardButtons\n            invert\n            leftLabel={isSubmitting ? t('questionary:submitting') : t('beforeSubmit:submitButton')}\n            leftDisabled={(isSubmitting || (recaptchaAvailable && !captchaValue) || !isValid)}\n            leftHandler={handleSubmit(onSubmit)}\n          />\n        </Portal>\n      )}\n    </MainContainer>\n  );\n};\n\nexport default React.memo(Step3);\n"],"sourceRoot":""}